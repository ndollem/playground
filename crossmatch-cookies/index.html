<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie sender page</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YV9LXF9F74"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-YV9LXF9F74');
    </script>
    <script>
        window.ahoyUserDefinedConfig = {
            sendBatch: true,
            //environment: 'production',
            environment: 'staging',
            plentyHostnameProduction: 'https://cdp.vidio.com',
            plentyHostnameStaging: 'https://cdp.int.vidio.com'
        };
        var urlParams = new URLSearchParams(window.location.search);
    </script>
    <script src="https://static-web.prod.vid.id/ahoy/ahoy-falcon-2022-01-13-02-35-43.js" defer
        crossorigin="true"></script>
    <script
        src="https://personalization.vidio.com/embed-internal.8324be04cc0adb1be9165f1847ed900281851c7a.js?enable_ptid=false"
        crossorigin="true" id="embed-internal" defer crossorigin="true"></script>
</head>
<body>

    <!--this part will be on GTM-->
    <script>
        (function () {
            var ahoyCheckerCounter = 0;
            var personalization = {
                ready: function () {
                    setTimeout(function () {
                        if (this.isReady()) {
                            //console.log("success to check AhoyEvent object from ahoy checker");
                            this.callback();
                        } else {
                            /*console.log("Attempt #" + ahoyCheckerCounter + " to check AhoyEvent object from ahoy checker");*/
                            this.counter();
                            if (ahoyCheckerCounter < 30) {
                                /*console.error("AhoyPageviewEvent is not loaded.");*/
                                this.ready();
                            }
                        }
                    }.bind(this), 500);
                },
                isReady: function () {
                    return (typeof window.AhoyEvent != 'undefined') && (typeof window.ahoy != 'undefined');
                },
                counter: function () {
                    return ahoyCheckerCounter++;
                },
                callback: function () {
                    /*PUT ADDITIONAL CODE HERE*/
                    window.AhoyEvent.sendPageviewEvent();

                    //send kmklabs.visitor to datalake
                    var _klyObject = typeof window.kly !== 'undefined' ? window.kly : window.kmklabs;
                    //window.AhoyEvent.sendPersonalizationUserEvent(_klyObject.visitor);

                    //sample how to get visitor_id
                    console.log("current domain ahoy_visitor = "+window.ahoy.visitorId);

                    //send current domain cookies to iframe agregator
                    this.sendSession();
                    /*END PUT ADDITIONAL CODE HERE*/
                },
                checkGAID: function(){
                    const cName = '_ga_YV9LXF9F74=',
                    gaID = document.cookie.split(';').find(v => {
                        return v.match(cName);
                    });
                    return gaID ? decodeURIComponent(gaID).trim().replace(cName, '') : 0;
                },
                sendSession: function(){
                    var ifrm = document.createElement("iframe"),
                        ifrmParam = "?senderCookies="+window.ahoy.visitorId+"&senderGAID="+this.checkGAID()+"&senderHost="+window.location.hostname;
                    console.log(ifrmParam);
                    ifrm.setAttribute("src", "https://d.kapanlaginetwork.com/banner/preview/2022/10/26/crossmatch-cookies/iframe.html"+ifrmParam);
                    ifrm.style.width = "1px";
                    ifrm.style.height = "1px";
                    ifrm.style.display = "none";
                    document.body.appendChild(ifrm);
                }
            };

            if (document.readyState == "complete") {
                personalization.ready();
            } else {
                window.addEventListener('load', function () {
                    personalization.ready();
                });
            }
        })();
    </script>
    <!--END this part will be on GTM-->

    <!--iframe src="https://d.kapanlaginetwork.com/banner/preview/2022/10/26/crossmatch-cookies/iframe.html"></iframe-->
    
</body>
</html>